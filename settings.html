<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setări - Anime Uke</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <style>
        .settings-card {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(146, 13, 13, 0.3);
        }
        
        .settings-icon {
            font-size: 2rem;
            color: #920d0d;
            margin-bottom: 15px;
            display: block;
        }
        
        .danger-zone {
            background: rgba(220, 53, 69, 0.1);
            border: 2px solid #dc3545;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .settings-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .theme-option {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .theme-option:hover {
            transform: translateY(-5px);
            border-color: #920d0d !important;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark-red">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="https://i.imgur.com/zocDECh.png" alt="Logo" height="40" class="me-2">
                <strong>ANIME UKE</strong>
            </a>
            <div id="userNavItem"></div>
        </div>
    </nav>

    <div class="container py-4">
        <h1 class="mb-4"><i class="fas fa-cogs"></i> Setări Cont</h1>
        
        <div class="alert alert-success d-none" id="successAlert">
            <i class="fas fa-check-circle"></i> <span id="successText"></span>
        </div>
        
        <div class="row">
            <div class="col-md-3">
                <div class="settings-card">
                    <h5 class="mb-4"><i class="fas fa-sliders-h"></i> Meniu Setări</h5>
                    
                    <div class="list-group list-group-flush">
                        <a href="#profile" class="list-group-item list-group-item-action bg-transparent text-white border-0 active" 
                           onclick="showSection('profile')">
                            <i class="fas fa-user me-2"></i> Profil
                        </a>
                        <a href="#security" class="list-group-item list-group-item-action bg-transparent text-white border-0"
                           onclick="showSection('security')">
                            <i class="fas fa-lock me-2"></i> Securitate
                        </a>
                        <a href="#notifications" class="list-group-item list-group-item-action bg-transparent text-white border-0"
                           onclick="showSection('notifications')">
                            <i class="fas fa-bell me-2"></i> Notificări
                        </a>
                        <a href="#appearance" class="list-group-item list-group-item-action bg-transparent text-white border-0"
                           onclick="showSection('appearance')">
                            <i class="fas fa-palette me-2"></i> Aspect
                        </a>
                    </div>
                    
                    <div class="mt-4 pt-3 border-top">
                        <a href="profile.html" class="btn btn-outline-light w-100 mb-2">
                            <i class="fas fa-arrow-left"></i> Înapoi la Profil
                        </a>
                        <a href="index.html" class="btn btn-outline-light w-100">
                            <i class="fas fa-home"></i> Acasă
                        </a>
                    </div>
                </div>
                
                <div class="settings-card mt-3">
                    <h6><i class="fas fa-info-circle"></i> Informații Cont</h6>
                    <div class="mt-3">
                        <div class="small mb-2">
                            <strong>Username:</strong><br>
                            <span id="currentUsername">-</span>
                        </div>
                        <div class="small mb-2">
                            <strong>Email:</strong><br>
                            <span id="currentEmail">-</span>
                        </div>
                        <div class="small mb-2">
                            <strong>Rol:</strong><br>
                            <span class="badge bg-danger" id="currentRole">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <div class="settings-card" id="profileSection">
                    <div class="settings-section">
                        <i class="fas fa-user settings-icon"></i>
                        <h4>Editare Profil</h4>
                        
                        <form id="profileForm" class="mt-4">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="settingsUsername" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="settingsUsername" 
                                           placeholder="Username" readonly>
                                    <small class="text-muted">Username-ul nu poate fi schimbat</small>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="settingsEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="settingsEmail" 
                                           placeholder="Email">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="settingsBio" class="form-label">Bio</label>
                                <textarea class="form-control" id="settingsBio" rows="3" 
                                          placeholder="Spune ceva despre tine..."></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-save"></i> Salvează Modificările
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="settings-card d-none" id="securitySection">
                    <div class="settings-section">
                        <i class="fas fa-lock settings-icon"></i>
                        <h4>Securitate</h4>
                        
                        <form id="passwordForm" class="mt-4">
                            <div class="mb-3">
                                <label for="currentPassword" class="form-label">Parola Curentă</label>
                                <input type="password" class="form-control" id="currentPassword" 
                                       placeholder="Introdu parola curentă">
                            </div>
                            
                            <div class="mb-3">
                                <label for="newPassword" class="form-label">Parola Nouă</label>
                                <input type="password" class="form-control" id="newPassword" 
                                       placeholder="Introdu parola nouă" minlength="6">
                                <div class="progress mt-2" style="height: 5px;">
                                    <div class="progress-bar" id="passwordStrengthBar" style="width: 0%"></div>
                                </div>
                                <small class="text-muted">Parola trebuie să aibă cel puțin 6 caractere</small>
                            </div>
                            
                            <div class="mb-4">
                                <label for="confirmPassword" class="form-label">Confirmă Parola Nouă</label>
                                <input type="password" class="form-control" id="confirmPassword" 
                                       placeholder="Introdu parola din nou">
                            </div>
                            
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-key"></i> Schimbă Parola
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="settings-card d-none" id="notificationsSection">
                    <div class="settings-section">
                        <i class="fas fa-bell settings-icon"></i>
                        <h4>Notificări</h4>
                        
                        <div class="mt-4">
                            <h6>Notificări prin Email</h6>
                            <div class="form-check form-switch mt-3">
                                <input class="form-check-input" type="checkbox" id="notifEmail" checked>
                                <label class="form-check-label" for="notifEmail">
                                    Notificări generale
                                </label>
                            </div>
                            
                            <div class="form-check form-switch mt-3">
                                <input class="form-check-input" type="checkbox" id="notifNewEpisodes" checked>
                                <label class="form-check-label" for="notifNewEpisodes">
                                    Episoade noi
                                </label>
                            </div>
                            
                            <div class="form-check form-switch mt-3">
                                <input class="form-check-input" type="checkbox" id="notifNews">
                                <label class="form-check-label" for="notifNews">
                                    Noutăți și anunțuri
                                </label>
                            </div>
                        </div>
                        
                        <button class="btn btn-danger mt-4" onclick="saveNotificationSettings()">
                            <i class="fas fa-save"></i> Salvează Setările
                        </button>
                    </div>
                </div>
                
                <div class="settings-card d-none" id="appearanceSection">
                    <div class="settings-section">
                        <i class="fas fa-palette settings-icon"></i>
                        <h4>Aspect</h4>
                        
                        <div class="mt-4">
                            <h6>Temă</h6>
                            <div class="row mt-3">
                                <div class="col-md-4 mb-3">
                                    <div class="theme-option p-3 rounded border" onclick="selectTheme('dark')" 
                                         style="background: #1a1a2e; cursor: pointer;">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="theme" id="themeDark" checked>
                                            <label class="form-check-label text-white" for="themeDark">
                                                Întunecat
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="theme-option p-3 rounded border" onclick="selectTheme('light')" 
                                         style="background: #f8f9fa; cursor: pointer;">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="theme" id="themeLight">
                                            <label class="form-check-label text-dark" for="themeLight">
                                                Deschis
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-5 pt-4 border-top">
                            <h6>Display Settings</h6>
                            <div class="mt-3">
                                <label for="fontSize" class="form-label">Mărime Font</label>
                                <select class="form-control" id="fontSize">
                                    <option value="small">Mic</option>
                                    <option value="medium" selected>Mediu</option>
                                    <option value="large">Mare</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn btn-danger mt-4" onclick="saveAppearanceSettings()">
                            <i class="fas fa-save"></i> Salvează Preferințele
                        </button>
                    </div>
                </div>
                
                <div class="danger-zone">
                    <h4 class="text-danger"><i class="fas fa-exclamation-triangle"></i> Zona de Pericol</h4>
                    
                    <div class="mt-4">
                        <button class="btn btn-outline-danger me-3" onclick="exportData()">
                            <i class="fas fa-download"></i> Exportă Datele Tale
                        </button>
                        
                        <button class="btn btn-outline-danger" onclick="deleteAccountPrompt()">
                            <i class="fas fa-trash"></i> Șterge Contul
                        </button>
                    </div>
                    
                    <div class="mt-3 small text-muted">
                        <i class="fas fa-info-circle"></i> Ștergerea contului este permanentă.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    
    <script src="firebase-config.js"></script>
    <script src="script.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('⚙️ Settings page loaded');
            
            if (!requireLogin()) {
                return;
            }
            
            const user = getCurrentUser();
            
            document.getElementById('currentUsername').textContent = user.username;
            document.getElementById('currentEmail').textContent = user.email;
            document.getElementById('currentRole').textContent = user.role.toUpperCase();
            
            document.getElementById('settingsUsername').value = user.username;
            document.getElementById('settingsEmail').value = user.email;
            
            updateUIBasedOnLogin();
            loadSavedSettings();
            
            document.getElementById('profileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('settingsEmail').value.trim();
                
                if (!email || !isValidEmail(email)) {
                    showMessage('Introdu o adresă de email validă!', 'error');
                    return;
                }
                
                showMessage('Setările au fost salvate!', 'success');
            });
            
            document.getElementById('passwordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newPass = document.getElementById('newPassword').value;
                const confirmPass = document.getElementById('confirmPassword').value;
                
                if (newPass !== confirmPass) {
                    showMessage('Parolele nu coincid!', 'error');
                    return;
                }
                
                if (newPass.length < 6) {
                    showMessage('Parola trebuie să aibă cel puțin 6 caractere!', 'error');
                    return;
                }
                
                showMessage('Parola a fost schimbată cu succes!', 'success');
                document.getElementById('passwordForm').reset();
                document.getElementById('passwordStrengthBar').style.width = '0%';
            });
            
            document.getElementById('newPassword').addEventListener('input', function() {
                const password = this.value;
                const strength = checkPasswordStrength(password);
                const bar = document.getElementById('passwordStrengthBar');
                
                if (password.length === 0) {
                    bar.style.width = '0%';
                    bar.className = 'progress-bar';
                    return;
                }
                
                let width = 0;
                let color = '';
                
                if (strength === 0) {
                    width = 25;
                    color = 'bg-danger';
                } else if (strength === 1) {
                    width = 50;
                    color = 'bg-warning';
                } else if (strength === 2) {
                    width = 75;
                    color = 'bg-info';
                } else {
                    width = 100;
                    color = 'bg-success';
                }
                
                bar.style.width = width + '%';
                bar.className = 'progress-bar ' + color;
            });
        });
        
        function showSection(sectionId) {
            ['profile', 'security', 'notifications', 'appearance'].forEach(section => {
                const element = document.getElementById(section + 'Section');
                if (element) {
                    element.classList.add('d-none');
                }
                
                const menuItem = document.querySelector(`[href="#${section}"]`);
                if (menuItem) {
                    menuItem.classList.remove('active');
                }
            });
            
            const sectionElement = document.getElementById(sectionId + 'Section');
            if (sectionElement) {
                sectionElement.classList.remove('d-none');
            }
            
            const menuItem = document.querySelector(`[href="#${sectionId}"]`);
            if (menuItem) {
                menuItem.classList.add('active');
            }
        }
        
        function loadSavedSettings() {
            const savedSettings = JSON.parse(localStorage.getItem('animeUkeSettings') || '{}');
            
            if (savedSettings.notifications) {
                document.getElementById('notifEmail').checked = savedSettings.notifications.email !== false;
                document.getElementById('notifNewEpisodes').checked = savedSettings.notifications.episodes !== false;
                document.getElementById('notifNews').checked = savedSettings.notifications.news !== false;
            }
            
            if (savedSettings.appearance) {
                document.getElementById('fontSize').value = savedSettings.appearance.fontSize || 'medium';
                
                if (savedSettings.appearance.theme) {
                    document.getElementById('theme' + savedSettings.appearance.theme.charAt(0).toUpperCase() + savedSettings.appearance.theme.slice(1)).checked = true;
                }
            }
        }
        
        function saveNotificationSettings() {
            const settings = {
                email: document.getElementById('notifEmail').checked,
                episodes: document.getElementById('notifNewEpisodes').checked,
                news: document.getElementById('notifNews').checked
            };
            
            saveSettings('notifications', settings);
            showMessage('Setările de notificări au fost salvate!', 'success');
        }
        
        function saveAppearanceSettings() {
            const theme = document.querySelector('input[name="theme"]:checked').value;
            const settings = {
                theme: theme,
                fontSize: document.getElementById('fontSize').value
            };
            
            saveSettings('appearance', settings);
            showMessage('Setările de aspect au fost salvate!', 'success');
        }
        
        function saveSettings(category, settings) {
            const allSettings = JSON.parse(localStorage.getItem('animeUkeSettings') || '{}');
            allSettings[category] = settings;
            localStorage.setItem('animeUkeSettings', JSON.stringify(allSettings));
        }
        
        function selectTheme(theme) {
            document.getElementById('theme' + theme.charAt(0).toUpperCase() + theme.slice(1)).checked = true;
        }
        
        function checkPasswordStrength(password) {
            let strength = 0;
            
            if (password.length >= 6) strength++;
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password) && /[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            return Math.min(strength, 4);
        }
        
        function showMessage(message, type) {
            const alert = document.getElementById('successAlert');
            const text = document.getElementById('successText');
            
            text.textContent = message;
            alert.className = `alert alert-${type === 'error' ? 'danger' : 'success'}`;
            alert.classList.remove('d-none');
            
            setTimeout(() => {
                alert.classList.add('d-none');
            }, 5000);
        }
        
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        function exportData() {
            const user = getCurrentUser();
            const data = {
                user: user,
                exportDate: new Date().toISOString(),
                settings: JSON.parse(localStorage.getItem('animeUkeSettings') || '{}')
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `anime-uke-data-${user.username}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('Datele tale au fost exportate!', 'success');
        }
        
        function deleteAccountPrompt() {
            if (confirm('ESTI SIGUR că vrei să ștergi contul? Această acțiune este PERMANENTĂ!')) {
                showMessage('Contul va fi șters. Aceasta este o funcție demonstrativă.', 'error');
            }
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
