// =====================================
// CONTROLE BUTOANE MULTIMEDIA TASTATURÄ‚
// =====================================

document.addEventListener('keydown', (e) => {
    console.log('DEBUG Key:', e.code, e.key, e.keyCode);
    
    // PLAY/PAUSE - Space, K, MediaPlayPause
    if (e.code === 'Space' || e.code === 'KeyK' || e.code === 'MediaPlayPause' || e.keyCode === 179) {
        e.preventDefault();
        togglePlayPause();
        return;
    }
    
    // NEXT EPISODE - N, L, ArrowRight, MediaTrackNext
    if (e.code === 'KeyN' || e.code === 'KeyL' || e.code === 'ArrowRight' || 
        e.code === 'MediaTrackNext' || e.keyCode === 176) {
        e.preventDefault();
        goToNextEpisode();
        return;
    }
    
    // PREVIOUS EPISODE - P, J, ArrowLeft, MediaTrackPrevious  
    if (e.code === 'KeyP' || e.code === 'KeyJ' || e.code === 'ArrowLeft' || 
        e.code === 'MediaTrackPrevious' || e.keyCode === 177) {
        e.preventDefault();
        goToPreviousEpisode();
        return;
    }
    
    // VOLUME UP/DOWN
    if (e.code === 'ArrowUp' || e.code === 'VolumeUp') {
        e.preventDefault();
        changeVolume(0.1);
        return;
    }
    
    if (e.code === 'ArrowDown' || e.code === 'VolumeDown') {
        e.preventDefault();
        changeVolume(-0.1);
        return;
    }
});

// =====================================
// FUNCÈšIILE DE CONTROL
// =====================================

// 1. PLAY/PAUSE
function togglePlayPause() {
    const iframe = document.getElementById('video-player');
    try {
        const player = iframe.contentWindow.player;
        if (player) {
            if (player.paused()) {
                player.play();
                showNotification('â–¶ï¸ Play');
            } else {
                player.pause();
                showNotification('â¸ï¸ Pause');
            }
        }
    } catch(e) {
        // Fallback pentru CORS
        showNotification('â¯ï¸ Play/Pause (CORS limit)');
    }
}

// 2. EPISOD ANTERIOR
function goToPreviousEpisode() {
    const prevEp = episodes.find(e => 
        e.animeSlug === 'one-piece' && e.number === currentEpisode.number - 1
    );
    if (prevEp) {
        showNotification('â®ï¸ Mergi la episodul anterior');
        setTimeout(() => {
            window.location.href = `/watch.html?anime=one-piece&ep=${prevEp.number}`;
        }, 300);
    } else {
        showNotification('âŒ EÈ™ti la primul episod');
    }
}

// 3. SCHIMBARE VOLUM
function changeVolume(delta) {
    const iframe = document.getElementById('video-player');
    try {
        const player = iframe.contentWindow.player;
        if (player) {
            const currentVol = player.volume();
            const newVol = Math.max(0, Math.min(1, currentVol + delta));
            player.volume(newVol);
            showNotification(`ğŸ”Š Volum: ${Math.round(newVol * 100)}%`);
        }
    } catch(e) {
        showNotification(`ğŸ”Š ${delta > 0 ? 'Volum +' : 'Volum -'}`);
    }
}

// 4. SALT ÃN TIMP
function seek(seconds) {
    const iframe = document.getElementById('video-player');
    try {
        const player = iframe.contentWindow.player;
        if (player) {
            const currentTime = player.currentTime();
            player.currentTime(currentTime + seconds);
            showNotification(`${seconds > 0 ? 'â©' : 'âª'} ${Math.abs(seconds)} sec`);
        }
    } catch(e) {
        showNotification(`${seconds > 0 ? 'Ãnainte' : 'Ãnapoi'} ${Math.abs(seconds)} sec`);
    }
}

// 5. FULLSCREEN
function toggleFullscreen() {
    const iframe = document.getElementById('video-player');
    if (document.fullscreenElement) {
        document.exitFullscreen();
        showNotification('âï¸ IeÈ™i din fullscreen');
    } else {
        iframe.requestFullscreen().catch(console.error);
        showNotification('ğŸ”² Fullscreen');
    }
}

// 6. NOTIFICARE PE ECRAN (temporarÄƒ)
function showNotification(message) {
    // EliminÄƒ notificarea veche dacÄƒ existÄƒ
    const oldNotif = document.getElementById('keyboard-notification');
    if (oldNotif) oldNotif.remove();
    
    // CreeazÄƒ notificare nouÄƒ
    const notification = document.createElement('div');
    notification.id = 'keyboard-notification';
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: rgba(230, 57, 70, 0.9);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: bold;
        z-index: 10000;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        animation: fadeInOut 2s ease;
    `;
    notification.textContent = message;
    
    // AdaugÄƒ stil pentru animaÈ›ie
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(notification);
    
    // EliminÄƒ automat dupÄƒ 2 secunde
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 2000);
}

// =====================================
// ADAUGÄ‚ ACEST STIL ÃN <head>
// =====================================
const style = document.createElement('style');
style.textContent = `
    /* Stil pentru notificÄƒri */
    #keyboard-notification {
        font-family: 'Segoe UI', sans-serif;
        font-size: 14px;
    }
    
    /* Indicator pentru controls activ */
    .controls-active {
        outline: 2px solid #e63946 !important;
        outline-offset: 2px;
    }
`;
document.head.appendChild(style);

// AfiÈ™eazÄƒ ajutor la apÄƒsarea tastei H
document.addEventListener('keydown', (e) => {
    if (e.code === 'KeyH' && e.ctrlKey) {
        alert(`ğŸ® CONTROLE TASTATURÄ‚ ANIMEUKE:
        
âŒ¨ï¸ BUTOANE MULTIMEDIA:
â€¢ Play/Pause = PLAY/PAUSE
â€¢ Next Track = Episod urmÄƒtor
â€¢ Previous Track = Episod anterior
â€¢ Volume Up/Down = Volum

âŒ¨ï¸ TASTE STANDARD:
â€¢ K = Play/Pause
â€¢ J = Episod anterior
â€¢ L = Episod urmÄƒtor
â€¢ â†/â†’ = Salt 10 secunde
â€¢ Shift+â†/â†’ = Salt 60 secunde
â€¢ F = Fullscreen
â€¢ M = Mute
â€¢ 0-9 = Salt la procent (ex: 5 = 50%)

â€¢ Ctrl+H = Acest ajutor`);
    }
});

console.log('ğŸ® Controale tastaturÄƒ activate!');
